<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Meteor Madness ‚Äî Visualizaci√≥n y simulaci√≥n web de impactos de asteroides con datos de NASA y USGS." />
  <title>Meteor Madness ‚Äî Asteroid Impact Simulator</title>

  <!-- CSS principal -->
  <link rel="stylesheet" href="styles.css" />

  <!-- Ajustes finos para evitar desbordes de texto -->
  <style>
    .card, label, small, p, h1, h2, h3, button, input, select, details, summary {
      overflow-wrap: anywhere;
      word-wrap: break-word;
      hyphens: auto;
    }
    .grid label > input, .grid label > select { min-width: 0; width: 100%; }
    #orbit3dCanvas { width: 100%; height: 380px; min-height: 360px; border-radius: 12px; background: #0f1024; }
  </style>

  <!-- Leaflet -->
  <link rel="preconnect" href="https://unpkg.com" crossorigin>
  <link rel="preconnect" href="https://tile.openstreetmap.org" crossorigin>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <!-- Three.js (una sola vez) -->
  <script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
  <script src="https://unpkg.com/three@0.160.0/examples/js/controls/OrbitControls.js"></script>
  <!-- Chart.js para gr√°ficas de resultados -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

</head>
<body>
  <header>
    <h1>üöÄ Meteor Madness</h1>
    <p>Plataforma de simulaci√≥n y an√°lisis de riesgo de impacto de asteroides (NASA + USGS).</p>
  </header>

  <main class="layout">
    <!-- Panel Dataset (IDs √öNICOS) -->
    <section class="panel card" aria-labelledby="dataset-title">
      <h2 id="dataset-title">NEOs del dataset (carga r√°pida)</h2>
      <div class="grid">
        <label>Selecciona NEO
          <select id="neoSelect" aria-label="Seleccionar NEO del dataset"></select>
        </label>
        <label>Info
          <div id="neoInfo" style="min-height:2.5em" aria-live="polite"></div>
        </label>
      </div>
      <button id="loadNeo" aria-label="Cargar NEO en simulador">Cargar NEO en simulador</button>
      <small>Precarga par√°metros orbitales, f√≠sicos y un escenario de impacto sugerido.</small>
    </section>

    <!-- Controles f√≠sicos y ubicaci√≥n -->
    <section class="controls card" aria-labelledby="params-title">
      <h2 id="params-title">Par√°metros del asteroide</h2>
      <div class="grid">
        <label>Di√°metro (m)
          <input id="diameter" type="range" min="1" max="2000" value="100" step="1" aria-label="Di√°metro del asteroide en metros">
          <span id="diameter-val" aria-live="polite">100</span>
        </label>
        <label>Densidad (kg/m¬≥)
          <input id="density" type="range" min="500" max="8000" value="3000" step="10" aria-label="Densidad del asteroide">
          <span id="density-val" aria-live="polite">3000</span>
        </label>
        <label>Velocidad (km/s)
          <input id="velocity" type="range" min="5" max="72" value="17" step="0.1" aria-label="Velocidad de entrada">
          <span id="velocity-val" aria-live="polite">17.0</span>
        </label>
        <label>√Ångulo de entrada (¬∞)
          <input id="angle" type="range" min="5" max="90" value="45" step="1" aria-label="√Ångulo de entrada">
          <span id="angle-val" aria-live="polite">45</span>
        </label>
        <label>Objetivo
          <select id="target" aria-label="Superficie objetivo">
            <option value="land">Tierra</option>
            <option value="water">Agua</option>
          </select>
        </label>
      </div>

      <h3>Ubicaci√≥n de impacto</h3>
      <p>Haz clic en el mapa para seleccionar <strong>lat/lon</strong>.</p>
      <div class="grid">
        <label>Latitud <input id="lat" type="number" step="0.0001" value="20.9671" aria-label="Latitud del impacto"></label>
        <label>Longitud <input id="lon" type="number" step="0.0001" value="-89.5926" aria-label="Longitud del impacto"></label>
      </div>

      <button id="simulate" class="button-primary" aria-label="Simular impacto">Simular impacto</button>

      <details class="edu">
        <summary>Overlays educativos</summary>
        <ul>
          <li><b>Excentricidad</b>: cu√°n estirada es la √≥rbita (0=c√≠rculo).</li>
          <li><b>Energ√≠a de impacto</b>: proporcional a masa √ó velocidad¬≤.</li>
          <li><b>Magnitud s√≠smica</b>: estimaci√≥n Mw desde energ√≠a liberada.</li>
        </ul>
      </details>
    </section>

    <!-- Mapa -->
    <section class="map card" aria-labelledby="map-title">
      <h2 id="map-title" class="sr-only">Mapa</h2>
      <div id="map" role="img" aria-label="Mapa base con c√≠rculos de da√±o potencial"></div>
      <div class="legend card" aria-hidden="true">
        <span class="pill pill-yellow"></span> Medio
        <span class="pill pill-orange"></span> Alto
        <span class="pill pill-red"></span> Catastr√≥fico
      </div>
    </section>

    <!-- Resultados + √ìrbita 2D -->
    <section class="panel card" aria-labelledby="results-title">
      <h2 id="results-title">Resultados</h2>
      <div id="results" class="info-box monospace"></div>

      <h2>√ìrbita (demo 2D)</h2>
      <canvas id="orbitCanvas" aria-label="Representaci√≥n 2D de la √≥rbita"></canvas>
      <div class="grid">
        <label>a (UA) <input id="a" type="number" step="0.01" value="1.2" aria-label="Semieje mayor (UA)"></label>
        <label>e <input id="e" type="number" step="0.001" value="0.2" aria-label="Excentricidad"></label>
        <label>i (¬∞) <input id="i" type="number" step="0.1" value="5" aria-label="Inclinaci√≥n"></label>
        <label>Œ© (¬∞) <input id="Omega" type="number" step="0.1" value="80" aria-label="Longitud del nodo ascendente"></label>
        <label>œâ (¬∞) <input id="omega" type="number" step="0.1" value="45" aria-label="Argumento del perihelio"></label>
        <label>M (¬∞) <input id="M" type="number" step="0.1" value="30" aria-label="Anomal√≠a media"></label>
      </div>
      <button id="drawOrbit" aria-label="Dibujar √≥rbita 2D">Dibujar √≥rbita</button>
      <h3 class="sub-header">Visualizaciones</h3>
<div class="grid">
  <div class="card" style="gap:8px;">
    <div class="card-header">Energ√≠a y TNT</div>
    <canvas id="chartEnergyTNT" height="140"></canvas>
  </div>
  <div class="card" style="gap:8px;">
    <div class="card-header">Radios de Efecto (km)</div>
    <canvas id="chartRadii" height="140"></canvas>
  </div>
</div>
<div class="grid">
  <div class="card" style="gap:8px;">
    <div class="card-header">Magnitud S√≠smica (Mw)</div>
    <canvas id="chartSeismic" height="140"></canvas>
  </div>
</div>

    </section>

    <!-- √ìrbita 3D + Mitigaci√≥n (Œîv) -->
    <section class="panel card" aria-labelledby="orbit3d-title">
      <h2 id="orbit3d-title">√ìrbita 3D + Mitigaci√≥n (Œîv)</h2>
      <div class="grid">
        <label>Œîv (m/s) <input id="dv_mag" type="number" value="50" step="1" aria-label="Magnitud del impulso"></label>
        <label>Direcci√≥n Œîv
          <select id="dv_dir" aria-label="Direcci√≥n del impulso">
            <option value="tangential">Tangencial (prograde/retro)</option>
            <option value="radial">Radial (hacia/desde el Sol)</option>
            <option value="normal">Normal al plano</option>
          </select>
        </label>
        <label>ŒΩ (¬∞) aplicaci√≥n <input id="dv_nu" type="number" value="0" step="1" aria-label="Anomal√≠a verdadera de aplicaci√≥n"></label>
      </div>
      <button id="applyDv" aria-label="Aplicar Œîv y dibujar √≥rbitas">Aplicar Œîv y dibujar</button>
      <div id="orbit3dCanvas"></div>
      <small class="disclaimer">Nota: modelo two-body con impulso instant√°neo para uso educativo.</small>
    </section>

    <!-- Buscar por ID/Nombre -->
    <section class="panel card" aria-labelledby="search-title">
      <h2 id="search-title">Buscar NEO por ID / Nombre (SBDB/NeoWs)</h2>
      <div class="grid">
        <label>ID/Nombre
          <input id="searchId" type="text" placeholder="Apophis, 99942, 433 Eros..." aria-label="ID o nombre del NEO">
        </label>
        <label>Fuente
          <select id="searchSource" aria-label="Fuente de datos del NEO">
            <option value="sbdb">SBDB (JPL)</option>
            <option value="neows">NeoWs (NASA)</option>
          </select>
        </label>
      </div>
      <button id="btnSearch" aria-label="Buscar y cargar NEO">Buscar y cargar</button>
      <div id="searchResult" style="margin-top:8px;min-height:2.5em" aria-live="polite"></div>
    </section>

    <!-- Exportaci√≥n -->
    <section class="panel card" aria-labelledby="export-title">
      <h2 id="export-title">Guardar escenario</h2>
      <div class="grid">
        <label>Nombre del escenario
          <input id="scenarioName" type="text" placeholder="Impactor-2025 (custom)" aria-label="Nombre del escenario">
        </label>
      </div>
      <div class="grid" style="grid-template-columns: 1fr 1fr;">
        <button id="btnExportJSON" aria-label="Exportar escenario como JSON">Exportar JSON</button>
        <button id="btnExportGeoJSON" aria-label="Exportar resultado como GeoJSON">Exportar GeoJSON</button>
      </div>
      <small>Descarga par√°metros actuales y geometr√≠as (impacto y zonas).</small>
    </section>
  </main>

  <footer>
    <small>Meteor Madness ‚Ä¢ Herramienta educativa ‚Ä¢ Datos: NASA NeoWs / USGS</small>
  </footer>

  <!-- Scripts finales -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script type="module" src="js/app.js"></script>
</body>
</html>
